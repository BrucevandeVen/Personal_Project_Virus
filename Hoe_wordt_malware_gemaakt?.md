# Hoe wordt malware gemaakt?

## Table Of Contents
- Test omgeving
- Voorbeelden
- Testing

## Test omgeving
Als eerste heb ik een test omgeving opgezet in VMWare. Ik heb de Windows 10 Education template gebruikt van seclab en deze verbonden met INTERNET-STATIC 0167, daarna heb ik een IP adres die ik nog niet in gebruik had toegewezen.  
  
![image](https://user-images.githubusercontent.com/58031089/147228669-9dcfe96b-63ee-4eb3-98fa-695e3c4f059e.png)  
  
Tot slot heb ik Visual Studio geïnstalleerd om in C# een soort malware te creëren, ik heb VS en C# gekozen omdat ik hier het meeste ervaring mee heb.

## Voorbeelden
Na het onderzoeken van hoe malware wordt gemaakt ben ik op aparte software gestuit genaamd [LimeRAT](https://github.com/NYAN-x-CAT/Lime-RAT), deze software heeft allerlei mallefide eigenschappen:  
![image](https://user-images.githubusercontent.com/58031089/147232111-7ed39d00-e968-40d4-9b65-0f003dedac0f.png)  
  
## Testing
Ik heb in mijn "veilige" test omgeving een programma geschreven om te testen of het mogelijk is om je computer te "slopen" door middel van .NET C# programma's.  
Een voorbeeld van mijn code (Software good practices even aan de kant gezet).  
![image](https://user-images.githubusercontent.com/58031089/147236306-f25964b5-57ee-4c8f-9cac-b2a747eb2078.png)
![image](https://user-images.githubusercontent.com/58031089/147236385-1722861d-4539-4165-8741-0889874ea4a2.png)  
De code is van [MalwareStudio](https://github.com/MalwareStudio/Virus_Destructive).  
  
In de code wordt in principe naar admin privileges gevraagd en daarna worden er een aantal Windows operating system bestanden verwijderd, waardoor Windows permanent kan crashen.  Na veel trekken en duwen in de code is het mij niet gelukt het programma uit te voeren.  
  
### Metasploit
In een 2e poging om malware te creëren heb ik een [video](https://www.youtube.com/watch?v=4H1cDYIMEPI&ab_channel=RedPython) gevolgd van Red Python, in deze video gebruikt hij tools van Kali Linux om een soort Backdoor spyware te creëren die na open complete toegang geeft aan de host van de malware.  

In het proces heb ik ontdekt dat er in veel mailservices zoals Gmail of Dropbox achtige services, een soort anti-virus ingebouwd zit waardoor mails niet binnenkomen of verzenden.  

Via Metasploit heb ik een link gemaakt en een server opgestart in kali linux, als deze link wordt geopend in hetzelfde netwerk als de kali machine kan je via Metasploit een aantal commands uitvoeren om de pc van het slachtoffer te infiltreren. Mijn eerste test was met het creëren van een .exe trojan, maar dit verliep zonder succes. De antivirus protectie op Windows is geavanceerd genoeg om de link te herkennen als virus.  
Dus na het uitschakelen van de real-time virus beveiliging was het mogelijk een sessie te starten na het openen van de link in de windows machine.  
![image](https://user-images.githubusercontent.com/58031089/149155633-457eed2c-b703-4af8-8426-4dddadf96cc0.png)  
Na het openen de sessie gestart op kali (er is een melding in kali metasploit dat de link is geopend)  
![image](https://user-images.githubusercontent.com/58031089/149155976-e1b8bf11-de2b-407d-aed2-50ebe0d7307c.png)  
Als ik meterpreter commands wil uitvoeren met een session moet ik session -i 1 gebruiken, dit zorgt er voor dat meterpreter wordt geïntantiëerd op de sessie en ik met "help" alle mogelijkheden kan opvragen die met de sessie mogelijk zijn.  
![image](https://user-images.githubusercontent.com/58031089/149157103-59d9a0aa-ab36-435a-9702-75aadcd32675.png)  
Hierboven een greep uit de opties.  
Als voorbeeld heb ik een screenshot gemaakt van het slachtoffers scherm:  
![image](https://user-images.githubusercontent.com/58031089/149157501-f0bdf38b-a992-46b1-867b-cface98e9c9f.png)  
  
Ik heb een hele interessante video over Metasploit gevonden van [David Bombal](https://www.youtube.com/watch?v=ES2P2hWuzDo&ab_channel=DavidBombal), hier wordt uitgelegt hoe Metasploit werkt en de omgang.

### Metasploit "under the radar"
Ik ga proberen de trojan code in een bestaand .exe bestand te verwerken zodat deze echt als trojan beschouwd kan worden en een stuk gevaarlijker wordt dan voorheen. Alle benodigdheden:  
- Metasploit reverse_tcp (generate -f c)
- x32dbg (JMP, Assembly)  
  
Tijdens het onderzoeken ben ik deze [Website](http://www.ethicalpentest.com/2018/01/generating-shellcode-using-msfvenom.html) tegengekomen waar binary shellcode wordt gegenereerd.  
  
Om het te encoden (om het extra onopvallend te maken) kan er msfvenom worden gebruikt. Voor het encoden heb ik een artikel van [Offensive Security](https://www.offensive-security.com/metasploit-unleashed/msfvenom/) gelezen. Om een lijst te krijgen van alle encoders is "msfvenom -l encoders" genoeg.  
![image](https://user-images.githubusercontent.com/58031089/149981876-1a66fff4-8e1b-4230-8265-363c5112c82d.png)  
Na het kiezen van een encoder (er worden ranks aangegeven, ik heb de hoogste gekozen) heb ik een stukje shellcode gegenereerd met deze command:  
![image](https://user-images.githubusercontent.com/58031089/149982572-1ea87554-ef74-43cd-970d-de468b83d281.png)





